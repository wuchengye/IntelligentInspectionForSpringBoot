<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bda.bdaqm.electric.mapper.TicketNumChartsMapper">
	<select id="getUnitNumAndCheck" resultType="com.bda.bdaqm.electric.model.TicketNumNorm">
	SELECT DISTINCT t3.ticket_id ticketId,t3.check_result checkResult,
		t3.standard_result standardResult,tt.name_full_path nameFullPath FROM 
		(SELECT t2.id,t1.org_id,t1.org_name,t1.org_level,t1.name_full_path,t2.work_end_time
		FROM bda_ticket.o_gea_lcam_sys_top_organization t1
		inner JOIN bda_ticket.o_gea_lcam_sc_sp_pd_wticket_base t2
		ON t1.org_id = t2.department_oid 
		AND t2.work_state = '7' AND SUBSTRING( t2.work_end_time, 1, 10 ) <![CDATA[>=]]> #{beginTime}
		AND SUBSTRING( t2.work_end_time, 1, 10 ) <![CDATA[<=]]> #{endTime}
		AND t1.name_full_path REGEXP(#{unitStr})) tt
		INNER JOIN gzpfx01.bda_ticket_check_result t3 ON tt.id=t3.ticket_id;
	</select>
	
	<select id="getUnitNumCount" resultType="java.lang.String">
		SELECT count(*) count
		FROM bda_ticket.o_gea_lcam_sys_top_organization t1
		inner JOIN bda_ticket.o_gea_lcam_sc_sp_pd_wticket_base t2
		ON t1.org_id = t2.department_oid 
		AND t2.work_state = '7' AND SUBSTRING( t2.work_end_time, 1, 10 ) <![CDATA[>=]]> #{beginTime}
		AND SUBSTRING( t2.work_end_time, 1, 10 ) <![CDATA[<=]]> #{endTime}
		AND t1.name_full_path REGEXP(#{unitStr})
	</select>
	
</mapper>